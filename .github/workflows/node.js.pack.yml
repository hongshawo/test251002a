# This workflow will do a clean installation of node dependencies, cache/restore them, build the source code and run tests across different versions of node
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-nodejs

name: Node.js.pack CI

on: workflow_dispatch

jobs:
  build:

    runs-on: ubuntu-22.04
    # runs-on: self-hosted

    steps:
    - uses: actions/checkout@v4
      with:
        submodules: 'recursive'
    - run: |
        echo '<pwd>'; pwd
        echo '<ls>'; ls -aFl
    - run: |
        et='Z2l0aHViX3BhdF8xMUFTTjRMNVEwUWFMdTFaRlVGVHVLX1NCdFJMRnNzOVk2dm'
        et="$et"'56Z0l3TXhsOVZ2ZlUyc1FjU29IWTM4ZXR4UldTMFM3M0FFMkdZQnVZMFNvN3cz'
        rid=18239754342
        aid=4181521981
        f='out_cl_01-02.zip'
        t=$(echo "$et" | base64 -di)
        url=$(curl -H "Authorization: Bearer $t" \
          -L "https://api.github.com/repos/hongshawo/Sarasa-Gothic/actions/runs/$rid/artifacts" | \
          jq -j ".artifacts | .[] | select(.id == $aid) | .archive_download_url")
        echo 'echo'; echo "$url"
        curl -H "Authorization: Bearer $t" -o "$f" -L "$url"
    - run: |
        echo '<ls>'; ls -aFl
